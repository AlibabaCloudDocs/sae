# 设置NAS存储

在通常情况下，存储在容器中数据是非持久化的，在容器销毁以后数据也将丢失。在当代高速发展的互联网环境下，数据丢失意味着线上生产环境的灾难性事件。SAE支持了NAS存储功能，解决了应用实例数据持久化和实例间多读共享数据的问题。

-   [开通NAS服务](https://nas.console.aliyun.com)
-   [创建通用型NAS文件系统]()
-   [添加挂载点]()

## 应用部署时配置NAS存储

1.  登录[SAE控制台](https://sae.console.aliyun.com)。

2.  在左侧导航栏单击**应用列表**，在**应用列表**页面上方选择**地域**，单击**创建应用**。

3.  在**应用基本信息**页签设置应用相关信息，并单击**下一步：应用部署配置**。

4.  在**应用部署配置**页签，选择**技术栈语言**和**应用部署方式**，设置部署参数。

5.  展开**持久化存储**区域，打开**应用NAS存储**开关。

6.  在**使用已有的NAS文件系统**所在行的下拉列表中选择待挂载的NAS，并设置**挂载源**和**容器路径**。

    ![挂载NAS配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8075623061/p67278.png)

7.  单击**下一步：确认规格**。

8.  在**确认规格**页签，查看您所创建应用的详细信息以及配置费用情况，并单击**确认创建**。


## 应用部署完成后挂载NAS

您可以在创建应用过程中设置NAS挂载，也可以在应用部署完成后配置。

1.  登录[SAE控制台](https://sae.console.aliyun.com)。

2.  在左侧导航栏单击**应用列表**，在**应用列表**页面上方选择**地域**，单击具体应用名称。

3.  在应用详情页面的右上角，单击**部署应用**。

4.  在**部署应用**页面，展开**持久化存储**区域，打开**应用NAS存储**开关，配置相关参数。

    ![挂载NAS配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8075623061/p67278.png)

5.  配置完成后单击**确认**。

    **说明：** 单击**确认**后，该应用将会被重启，请在业务较少的时间段进行。


## 结果验证

本文介绍了不同系统下验证NAS挂载是否成功的方式，您可以根据实际需要选择验证方式。

-   Linux、Unix、Mac系统：
    -   （推荐）方法一：执行以下命令查询应用中是否存在NAS挂载信息。

        ```
        cat /proc/mounts | grep nfs
        ```

        当显示如下信息时，表示NAS挂载成功。

        ![成功挂载nas存储](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1847543061/p70160.png)

    -   方法二：使用Webshell读写文件验证NAS挂载是否成功。

        例如准备2个应用实例A和B，分别挂载NAS。对A执行写入命令`echo "hello" > tmp.txt`，对B执行读取命令`cat tmp.txt`。如果B中能够读取到在A中写入的`hello`，表示NAS挂载成功。

-   Windows系统：
    -   （推荐）方法一：在[NAS控制台](https://nasnext.console.aliyun.com/)查看。

        在NAS挂载点的**挂载使用**页面，单击目标挂载点**操作**列的**已挂载客户端**，在**已挂载客户端**对话框查看是否存在该应用的实例IP地址。更多信息，请参见[查看已挂载的客户端列表]()。如果**已挂载的客户端**对话框中应用的实例IP地址与SAE控制台中对应的应用实例IP地址相同，表示NAS挂载成功。

        **说明：** **已挂载客户端**对话框中仅显示近一分钟内正在使用NAS的客户端IP地址。

    -   方法二：在SAE控制台查看。

        在应用变更详情页，查看变更状态是否成功，如果显示成功，表示部署成功，即NAS挂载成功。

        ![sae挂载nas成功](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0510723061/p70176.png)


## 取消挂载NAS

挂载NAS后，如果您不再使用NAS存储，可以取消挂载NAS。具体操作，请参见[应用部署时配置NAS存储](#section_8dz_nai_u49)，在步骤4中关闭**应用NAS存储**开关，并单击**确认**。

**说明：**

-   取消挂载NAS后，SAE会重新部署应用，请在业务较少的时间段配置。
-   在SAE控制台取消挂载NAS后，您在NAS中所存储的数据仍然存在，不会被删除。

## 常见问题

-   如何查看NAS中的内容？

    如果您需要查看NAS中的内容，需要将NAS挂载到具体的ECS或容器上查看。具体操作，请参见以下文档：

    -   [Windows系统挂载NFS文件系统]()
    -   [Windows系统挂载SMB文件系统]()
    -   [Linux系统挂载SMB文件系统]()
    -   [Linux系统挂载NFS文件系统]()
-   文件日志指定的目标路径，可以与NAS指定的存储路径相同吗？

    不可以，会导致日志存储失败。


## 问题反馈

如果您在使用SAE过程中有任何疑问，欢迎您扫描下面的二维码或搜索钉钉群号23198618，加入钉钉群与我们交流。

![SAE钉钉群2](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1176199061/p72048.png)

