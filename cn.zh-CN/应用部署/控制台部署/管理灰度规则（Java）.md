# 管理灰度规则（Java）

对于部署在SAE的Spring Cloud或Dubbo微服务应用，为了确保升级操作的安全性，您可以通过启用灰度发布（即金丝雀发布）的灰度规则进行小规模验证，验证通过后再全量升级。本文介绍如何在SAE控制台上创建、查看、编辑和删除灰度规则。

您已在SAE创建并部署Spring Cloud或Dubbo微服务应用。具体操作，请参见以下文档：

-   [使用Spring Cloud开发微服务应用并部署至SAE](/cn.zh-CN/应用开发/使用Spring Cloud开发应用/使用Spring Cloud开发微服务应用并部署至SAE.md)
-   [使用Spring Boot开发Dubbo应用并部署至SAE](/cn.zh-CN/应用开发/使用Dubbo开发应用/使用Spring Boot开发Dubbo应用.md)

如果您的应用有多个应用实例且需要升级，那么您可以按需通过灰度或分批发布方式升级应用实例版本。其中，针对Spring Cloud和Dubbo微服务的灰度发布需要启动灰度规则才能实现。

更多信息，请参见[灰度发布或分批发布](/cn.zh-CN/应用部署/控制台部署/灰度发布或分批发布.md)。

## 创建灰度规则

1.  登录[SAE控制台](https://sae.console.aliyun.com)。

2.  在左侧导航栏，单击**应用列表**。

3.  在顶部菜单栏，选择地域。

4.  在应用列表页面单击具体应用名称，进入应用详情页面。

5.  在左侧导航栏，选择**微服务治理** \> **灰度规则**。

6.  在**灰度规则**页面，单击**新建灰度规则**。

7.  在**新建灰度规则**面板，执行以下操作，然后单击**确定**。

    SAE支持的灰度规则是按内容灰度，您所需配置的参数会因应用框架而异。

    1.  按需配置以下参数。

        |参数|说明|
        |--|--|
        |**规则名称**|灰度规则的名称。支持以小写字母开头，以数字或小写字母结尾，仅可包含小写字母、中文字符、数字及短划线（-）。不超过64个字符。|
        |**规则描述**|灰度规则的描述信息。不超过64个字符。|
        |**框架类型**|配置灰度规则应用的框架类型，当前支持以下框架：        -   **Spring Cloud**：需要设置**Path**。
        -   **Dubbo**：需要选择**服务方法**。 |
        |**条件模式**|选择**同时满足下列条件**或**满足下列任一条件**。|

    2.  单击**添加新的规则条件**，按需配置灰度规则条件。

        |参数|说明|
        |--|--|
        |**条件列表**|        -   **Spring Cloud**：可根据**Cookie**、**Header**或**Parameter**类型设置具体的参数。
        -   **Dubbo**：根据应用实际情况，设置**参数**、**参数值获取表达式**、**条件**以及**值**。 |

    3.  单击**新建流量规则**创建多个入口流量规则，多个规则可以同时生效。

    ![Spring Cloud应用灰度规则示例](../images/p271218.png "Spring Cloud应用灰度规则示例")

    创建成功后，您将在**灰度规则**页面查看到刚创建的灰度规则。同时，**新建灰度规则**按钮已置灰。


## 查看规则详情

1.  在**灰度规则**页面，找到您需查看的灰度规则，单击规则名称。

2.  在**灰度规则详情**面板，查看规则内容。

    ![灰度规则详情](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1781130261/p271219.png)


## 编辑灰度规则

1.  在**灰度规则**页面，找到您需编辑的灰度规则，在其**操作**列，单击**编辑**。

2.  在**编辑灰度规则**面板，按需更新规则内容。

3.  单击**确定**。


## 删除灰度规则

1.  在**灰度规则**页面，找到您需删除的灰度规则，在其**操作**列，单击**删除**。

2.  在弹出的**提示**对话框，单击**确认**。


