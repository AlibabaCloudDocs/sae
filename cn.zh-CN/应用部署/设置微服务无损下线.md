---
keyword: [优雅下线, 无损下线, 微服务应用]
---

# 设置微服务无损下线

如果您期望托管至SAE的微服务应用处理完请求后再停止应用，您可以使用SAE无损下线功能。SAE支持Spring Cloud和Dubbo应用无损下线。本文介绍如何在SAE控制台上配置无损下线。

## 应用部署时设置微服务无损下线

1.  登录[SAE控制台](https://sae.console.aliyun.com)。

2.  在左侧导航栏单击**应用列表**，在**应用列表**页面上方选择**地域**，单击**创建应用**。

3.  在**应用基本信息**页签设置应用相关信息，并单击**下一步：应用部署配置**。

4.  在**应用部署配置**页签，选择**技术栈语言**和**应用部署方式**，设置部署参数。

5.  在**应用部署配置**页面，展开**微服务无损下线配置**区域，单击**微服务无损下线配置向导**。

    ![微服务无损下线配置向导](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1464736061/p185270.png)

6.  在**微服务无损下线配置向导**面板，设置相关参数，单击**预览配置**。

    ![微服务无损下线](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5287796061/p185291.png)

    参数说明如下。

    |变量名称|参数说明|
    |----|----|
    |是否开启优雅下线服务治理能力|默认为**true**。取值说明如下：    -   **true**：开启。
    -   **false**：关闭。 |
    |SAE优雅下线功能占用端口|默认端口为**54199**。如果此默认端口和您应用的端口产生冲突，请配置新的端口。|
    |收到Spring的ContextClosedEvent事件后，进程动态等待关闭的时间|默认取值为**5000**，即进程收到kill信号后，会等待5000 ms再关闭。配置该参数后，需要设置是否开启自动等待功能参数为**false**。 |
    |是否开启自动等待功能|默认为**true**。取值说明如下：    -   **true**：开启。进程可能会随着流量停止而提前关闭。
    -   **false**：关闭。进程直接等待收到Spring的ContextClosedEvent事件后，进程动态等待关闭的时间所配置的值的对应时长后再关闭。 |

7.  在**应用生命周期管理设置**区域，确认相关配置，单击**确认**。

    ![确认无损下线配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1464736061/p185304.png)

8.  单击**下一步：确认规格**。

9.  在**确认规格**页签，查看您所创建应用的详细信息以及配置费用情况，并单击**确认创建**。


## 应用部署完成后设置微服务无损下线

1.  登录[SAE控制台](https://sae.console.aliyun.com)。

2.  在左侧导航栏单击**应用列表**，在**应用列表**页面上方选择**地域**，单击具体应用名称。

3.  在应用详情页面的右上角，单击**部署应用**。

4.  在**部署应用**页面，展开**微服务无损下线配置**区域，单击**微服务无损下线配置向导**。

    ![微服务无损下线配置向导](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1464736061/p185270.png)

5.  在**微服务无损下线配置向导**面板，设置相关参数，单击**预览配置**。

    ![微服务无损下线](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5287796061/p185291.png)

    参数说明如下。

    |变量名称|参数说明|
    |----|----|
    |是否开启优雅下线服务治理能力|默认为**true**。取值说明如下：    -   **true**：开启。
    -   **false**：关闭。 |
    |SAE优雅下线功能占用端口|默认端口为**54199**。如果此默认端口和您应用的端口产生冲突，请配置新的端口。|
    |收到Spring的ContextClosedEvent事件后，进程动态等待关闭的时间|默认取值为**5000**，即进程收到kill信号后，会等待5000 ms再关闭。配置该参数后，需要设置是否开启自动等待功能参数为**false**。 |
    |是否开启自动等待功能|默认为**true**。取值说明如下：    -   **true**：开启。进程可能会随着流量停止而提前关闭。
    -   **false**：关闭。进程直接等待收到Spring的ContextClosedEvent事件后，进程动态等待关闭的时间所配置的值的对应时长后再关闭。 |

6.  在**应用生命周期管理设置**区域，确认相关配置，单击**确认**。

    ![确认无损下线配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1464736061/p185304.png)

7.  配置完成后单击**确认**。

    **说明：** 单击**确认**后，该应用将会被重启，请在业务较少的时间段进行。


## 问题反馈

如果您在使用SAE过程中有任何疑问，欢迎您扫描下面的二维码或搜索群号23198618，加入钉钉群与我们交流。

![SAE钉钉群2](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4279867061/p72048.png)

