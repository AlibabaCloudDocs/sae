# 配置热点规则

为应用配置热点规则后，SAE将分析资源调用过程中调用次数高的参数，并根据配置的热点规则对包含热点参数的资源调用进行限流，保障系统的稳定性。本文介绍配置热点规则的操作步骤。

请确保您的Java应用已开启限流降级功能，详情请参见[设置限流降级]()。

## 背景信息

热点即经常被访问的数据。例如在以下场景中需要统计某个热点数据中访问频次最高的Top数据，并对其访问进行限制。

-   针对一段时间内最频繁购买的商品ID进行限制，防止击穿缓存而导致大量请求到数据库的情形。
-   针对一段时间内频繁访问的用户ID进行限制，防止恶意刷单。

AHAS利用LRU（Least Recently Used）策略统计最近最常访问的热点参数，结合令牌桶算法来进行参数级别的流控。

## 使用说明

热点规则的使用说明和常见场景请参见[配置热点规则](/cn.zh-CN/应用防护/配置规则/配置热点规则.md)。

## 操作步骤

1.  登录[SAE控制台](https://sae.console.aliyun.com)。

2.  在左侧导航栏单击**应用列表**，在**应用列表**页面上方选择**地域**，单击具体应用名称。

3.  在左侧导航栏中选择**限流降级（Java）** \> **规则管理**。

4.  在**规则管理**页面，单击**热点规则**，在**热点规则**页签，单击**新增热点限流规则**。

5.  在**新增热点限流规则**对话框，设置参数，单击**新建**。

    ![新增热点限流规则](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/8866680061/p169706.png)

    参数说明如下：

    |参数|描述|
    |--|--|
    |**接口名称**|适用该规则的资源名称，与埋点传入的资源名保持一致。|
    |**参数位置索引**|埋点传入参数的索引位置。对应`SphU.entry(xxx,args)`中的参数索引位置。例如`SphU.entry(resourceName,Entry Type.IN,1,paramA,paramB)`埋点中，`paramA`的参数索引是0，`paramB`的参数索引是1。|
    |**统计维度**|可选择通过请求数或并发线程数。     -   **通过请求数**：限制一段时间内的调用次数。
    -   **并发数**：限制该资源调用的并发数。 |
    |**统计周期时间**|统计窗口时间长度（单位为秒）。例如统计窗口时长为10s，QPS阈值为5代表限制10s内每个热点参数访问不超过5次。|
    |**单机阈值**|是作用于每个热点参数的阈值。|
    |**流控效果**|当**统计维度**为**通过请求数**时，可以选择流控效果来处理被拦截的流量。     -   **快速失败**：达到阈值时，立即拦截请求。该模式下可以额外设置一个**缓冲请求数**，即针对突发请求额外允许的请求数目。
    -   **排队等待**：请求匀速通过，允许排队等待，通常用于消息队列削峰填谷等场景。需设置具体的超时时间，排队时会计算预计的排队时长，若超过最大超时时间则请求会直接被拒绝。例如，**单机阈值**配置为5，则代表请求每200 ms才能通过一个，多出的请求将排队等待通过。**超时时间**配置1000 ms，则当前排队请求超过5个（\>1000 ms）时，新到来的请求将会直接被拒绝。 |


## 问题反馈

如果您在使用SAE过程中有任何疑问，欢迎您扫描下面的二维码加入钉钉群进行反馈。

![SAE钉钉群2](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/5885359951/p72048.png)

